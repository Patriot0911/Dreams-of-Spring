<!DOCTYPE html>
<html lang="en">
<head>
    <title>Task List</title>
    <link rel="stylesheet" href="/styles/task-list.css">
</head>
<body>
    <script>
        function deleteTask(taskId) {
            if(confirm(`Are you sure you want to delete this task? (${taskId})`)) {
                fetch(`/tasks/${taskId}`, {
                    method: 'DELETE',
                }).then((response) => {
                    if (response.ok) {
                        document.getElementById(`task-${taskId}`).remove();
                    } else if (response.redirected) {
                        window.location.href = response.url;
                    } else {
                        console.error('Error deleting task');
                    }
                });
            };
        };
        function test(event) {
            event.preventDefault();
            putTask();
        };
        function putTask() {
            const task = {
                id: document.getElementById('edit-id').value,
                title: document.getElementById('edit-title').value,
                description: document.getElementById('edit-description').value,
                priority: parseInt(document.getElementById('edit-priority').value),
                date: document.getElementById('edit-date').value,
                completed: document.getElementById('edit-completed').checked,
            };
            fetch("/tasks", {
                method: 'PUT',
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(task),
            }).then(
                (res) => {
                    console.log(res);
                }
            );
        };
        function editTask(taskId, title, description, date, priority, completed) {
            document.getElementById('edit-id').value = taskId;
            document.getElementById('edit-title').value = title;
            document.getElementById('edit-description').value = description;
            document.getElementById('edit-priority').value = priority;
            document.getElementById('edit-date').value = date;
            document.getElementById('edit-completed').checked = completed === 'true';

            document.getElementById('edit-form-wrapper').style.display = 'block';
        };
    </script>
    <main>
        <div class="tasks-wrapper">
            <h1>Tasks</h1>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Date</th>
                        <th>Priority</th>
                        <th>Completed</th>
                        <th class="action"></th>
                        <th class="action"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="task : ${tasks}" id="${task.id}">
                        <td th:text="${task.id}">1</td>
                        <td th:text="${task.title}">1</td>
                        <td th:text="${task.description}">1</td>
                        <td th:text="${task.date}">1</td>
                        <td th:text="${task.priority}">1</td>
                        <td th:text="${task.completed}">1</td>
                        <td>
                            <button th:onclick="editTask([[${task.id}]], [[${task.title}]], [[${task.description}]], [[${task.date}]], [[${task.priority}]], [[${task.completed}]])">Edit</button>
                        </td>
                        <td>
                            <button th:onclick="deleteTask([[${task.id}]]);">Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="edit-form-wrapper" style="display: none;">
            <form
                id="edit-form"
                onsubmit="test(event);"
            >
                <h2>Edit Task</h2>
                <input type="hidden" id="edit-id" name="id"  />
                <div>
                    <label for="edit-title">Task Title:</label>
                    <input type="text" id="edit-title" name="title" required/><br/>
                </div>

                <div>
                    <label for="edit-description">Description:</label>
                    <textarea id="edit-description" name="description" required></textarea><br/>
                </div>

                <div>
                    <label for="edit-priority">Task Priority:</label>
                    <input type="number" id="edit-priority" name="priority"  required/><br/>
                </div>

                <div>
                    <label for="edit-date">Due Date:</label>
                    <input type="date" id="edit-date" name="date"  required/><br/>
                </div>

                <div>
                    <label for="edit-completed">Completed:</label>
                    <input type="checkbox" id="edit-completed" name="completed" /><br/>
                </div>
                <input
                    type="submit"
                    value="Save"
                />
            </form>
        </div>
        <div>
            <form class="add-form" th:action="@{/tasks}" th:object="${new_task}" method="post">
                <h2>New Task</h2>
                <div>
                    <label for="title">Task Title:</label>
                    <input type="text" id="title" th:field="*{title}" required/><br/>
                </div>

                <div>
                    <label for="description">Description:</label>
                    <textarea id="description" th:field="*{description}" required></textarea><br/>
                </div>

                <div>
                    <label for="priority">Task Priority:</label>
                    <input type="number" id="priority" th:field="*{priority}" required/><br/>
                </div>

                <div>
                    <label for="date">Due Date:</label>
                    <input type="date" id="date" th:field="*{date}" required/><br/>
                </div>

                <div>
                    <label for="completed">Completed:</label>
                    <input type="checkbox" id="completed" th:field="*{completed}"/><br/>
                </div>
                <input type="submit" value="Add Task"/>
            </form>
        </div>
    </main>
</body>
</html>